<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Appointments Table</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
       <link rel="stylesheet" href="styles.css">
         
  </head>
  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
      <a class="navbar-brand" href="#">Appointments Table</a>
      <div class="navbar-collapse collapse w-100 order-1 order-md-0 dual-collapse2">
        
        <ul class="navbar-nav mr-auto">
          <!-- Add any menu items you want to include in the navbar -->
        </ul>
      </div>
      <div class="mx-auto order-0">      
      <div class="navbar-collapse collapse w-100 order-2 dual-collapse2">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="/logout">Logout</a>
          </li>
        </ul>
      </div>
    </nav><br /><br />
    <h3>Hi there, {{username}}</h3>
    <center>
      <button class="p-3 mb-2 bg-info text-white">View History</button><br /><br />
    </center>
    <center><b><h3>Current Appointments</h3></b></center>
    <!-- Patient Table -->
    <table id="dtBasicExample" class="table table-striped table-bordered table-sm" cellspacing="0" width="100%">
  <thead>
    <tr>
      <th class="th-sm">Name
      </th>
      <th class="th-sm">Age
      </th>
      <th class="th-sm">Gender
      </th>
      <th class="th-sm"> Contact
      </th>
      <th class="th-sm">Address
      </th>
      <th class="th-sm">Action
      </th>
     
    </tr>
  </thead>
 
   <tbody>
        {{#each patients}}
        <tr>
          <td>{{this.name}}</td>
          <td>{{this.age}}</td>
          <td>{{this.gender}}</td>
          <td>{{this.contact}}</td>
          <td>{{this.address}}</td>
         <td>
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal" onclick="populateForm('{{this.name}}', {{this.contact}})">View</button>
      </td>

        </tr>
        {{/each}}










      </tbody>
  <tfoot>
   
  </tfoot>
</table>





   <!-- Modal -->
<div class="modal fade" id="myModal">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title"> </span></h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>
      <div class="modal-body">
    
     <form>
          
          <div class="mb-3">
            <label for="name" class="form-label">Name:</label>
            <input type="text" class="form-control" id="name" name="name">
          </div>
          <div class="mb-3">
            <label for="contact" class="form-label">Contact:</label>
            <input type="text" class="form-control" id="contact" name="contact">
          </div>
          <div class="mb-3">
            <label for="codition" class="form-label">Condition:</label>
            <input type="text" class="form-control" id="condition" name="condition" required>
          </div>
          <div class="mb-3">
            <label for="description" class="form-label">Description:</label>
            <textarea type="text" class="form-control" id="description" name="description" required></textarea>
          </div>
          <div class="mb-3">
            <label for="prescription" class="form-label">Prescription:</label>
            <textarea type="text" class="form-control" id="prescription" name="prescription" required></textarea>
          </div>
            <button type="submit"  class="btn btn-primary">Save changes</button>
        </form>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
       
      </div>
    </div>
  </div>
</div>


<!-- JavaScript -->
<script>
  function populateForm(name, contact) {
    // Get the input fields
    var nameField = document.getElementById("name");
    var contactField = document.getElementById("contact");
    
    // Set their values
    nameField.value = name;
    contactField.value = contact;
  }
</script>



       <script>

      // Handle form submission
      const form = document.querySelector('form');
      form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const name = form.elements.name.value;
        const contact = form.elements.contact.value;
        const condition= form.elements.condition.value;
        const description = form.elements.description.value;
        const prescription = form.elements.prescription.value;

    const response = await fetch('/addRecord', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded'
    },
      body: `name=${encodeURIComponent(name)}&contact=${encodeURIComponent(contact)}&condition=${encodeURIComponent(condition)}&description=${encodeURIComponent(description)}&prescription=${encodeURIComponent(prescription)}`
    });

    if (response.ok) {
        // successful
        alert("Patient record updated successfully");
        window.location.reload();
      } else {
         // display error message
        const data = await response.json();
        alert(data.message); 
      }   
        
      });

    </script>



      <!-- jQuery first, then Popper.js, then Bootstrap JS -->
      <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
      <!-- MDB core JavaScript -->
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.10/js/mdb.min.js"></script>




  </body>
</html>
